# ë°±ì—…/ë³µì› ê²€ì¦: ì£¼ë¬¸ ê±´ + ì£¼ë¬¸ ìƒíƒœ ì™„ì „ ì €ì¥Â·ë³µì›

**ëª©ì **: GDM ë”ë¸”ì²´í¬ â€” ì£¼ë¬¸ ë°ì´í„°ë¿ ì•„ë‹ˆë¼ **ì£¼ë¬¸ì˜ ìƒíƒœ**ê¹Œì§€ ë°±ì—…ì— í¬í•¨ë˜ê³  ë³µì› ì‹œ ë™ì¼í•˜ê²Œ ë³µì›ë˜ëŠ”ì§€ ê²€ì¦Â·ê¸°ë¡.

---

## 1. ì €ì¥ ë²”ìœ„ (ë°±ì—…ì— í¬í•¨ë˜ëŠ” ê²ƒ)

### 1.1 ë°©ì‹

- **ë°ì´í„°ë² ì´ìŠ¤**: `pg_dump`ë¡œ **DB ì „ì²´** ë¤í”„. í…Œì´ë¸”/ì»¬ëŸ¼ ì„ íƒ ì œì™¸ ì—†ìŒ.
- **íŒŒì¼**: `simple_backup_system.py`ì˜ `source_files`ì— ì •ì˜ëœ ì‹œìŠ¤í…œ íŒŒì¼ ë³µì‚¬.

### 1.2 ì£¼ë¬¸ í…Œì´ë¸” `orders` â€” ìƒíƒœ ê´€ë ¨ ì»¬ëŸ¼

| ì»¬ëŸ¼ | ì„¤ëª… | ë°±ì—… í¬í•¨ |
|------|------|-----------|
| `id` | ì£¼ë¬¸ PK | âœ… |
| `status` | ì£¼ë¬¸ ë‹¨ê³„ (RECEIVED â†’ HAPPYCALL â†’ MEASURE â†’ DRAWING â†’ CONFIRM â†’ PRODUCTION â†’ CONSTRUCTION â†’ CS â†’ COMPLETED) | âœ… |
| `original_status` | ì›ë³¸ ìƒíƒœ ë³´ê´€ | âœ… |
| `cabinet_status` | ìˆ˜ë‚©ì¥ ìƒíƒœ (RECEIVED/IN_PRODUCTION/SHIPPED) | âœ… |
| `structured_data` | JSONB: ERP ì›Œí¬í”Œë¡œìš°, ì²´í¬ë¦¬ìŠ¤íŠ¸, ì‹¤ì¸¡Â·ë„ë©´Â·ì„¤ì¹˜ ë“± **ëª¨ë“  êµ¬ì¡°í™” ìƒíƒœ** | âœ… |
| `structured_schema_version`, `structured_confidence`, `structured_updated_at` | êµ¬ì¡°í™” ë©”íƒ€ | âœ… |
| ê¸°íƒ€ | received_date, customer_name, scheduled_date, measurement_date, is_erp_beta ë“± **ì „ì²´ ì»¬ëŸ¼** | âœ… |

`pg_dump`ëŠ” ìŠ¤í‚¤ë§ˆ+ë°ì´í„° ì „ì²´ë¥¼ ë¤í”„í•˜ë¯€ë¡œ ìœ„ ì»¬ëŸ¼ì´ ë¹ ì§€ì§€ ì•ŠìŒ.

### 1.3 ê´€ë ¨ í…Œì´ë¸” (ì£¼ë¬¸ ìƒíƒœÂ·ì´ë ¥)

| í…Œì´ë¸” | ì—­í•  | ë°±ì—… í¬í•¨ |
|--------|------|-----------|
| `order_events` | ë‹¨ê³„ ë³€ê²½/ì¼ì • ë³€ê²½ ë“± ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ | âœ… |
| `order_tasks` | íŒ”ë¡œì—…/ì´ìŠˆ ì¶”ì  | âœ… |
| `order_attachments` | ì²¨ë¶€ ë©”íƒ€ (íŒŒì¼ì€ R2 ë“± ìŠ¤í† ë¦¬ì§€) | âœ… |
| ê¸°íƒ€ ì£¼ë¬¸ FK í…Œì´ë¸” | ëª¨ë‘ DB ë‚´ | âœ… |

---

## 2. ë³µì› ë°©ì‹

- **ìŠ¤í¬ë¦½íŠ¸**: ê° ë°±ì—… í´ë”ì˜ `ğŸ”§_ë³µêµ¬_ìŠ¤í¬ë¦½íŠ¸.bat` (ë˜ëŠ” ë™ì¼ ë‚´ìš©ì˜ ìˆ˜ë™ ëª…ë ¹).
- **ëª…ë ¹**: `psql -U ... -h ... -d ... -f "database_backup_YYYYMMDD_HHMMSS.sql"`.
- **ê²°ê³¼**: ë¤í”„ëœ **ì „ë¶€**ê°€ í˜„ì¬ DBì— ë®ì–´ì“°ê¸°(ë˜ëŠ” ë¹ˆ DBì— ì ì¬). ë”°ë¼ì„œ **ì£¼ë¬¸ ê±´ + status/original_status/cabinet_status/structured_data** ë“± ìƒíƒœ ì „ë¶€ê°€ ë³µì› ì‹œì ê³¼ ë™ì¼í•˜ê²Œ ë³µì›ë¨.

---

## 3. ë”ë¸”ì²´í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] `orders.status` â€” pg_dump ëŒ€ìƒ í…Œì´ë¸”ì— í¬í•¨ë¨.
- [x] `orders.original_status`, `orders.cabinet_status` â€” ë™ì¼.
- [x] `orders.structured_data` (JSONB) â€” ì›Œí¬í”Œë¡œìš°Â·ì²´í¬ë¦¬ìŠ¤íŠ¸ ë“± í¬í•¨, pg_dumpì— í¬í•¨ë¨.
- [x] ë³µì› ì‹œ `psql -f`ë¡œ ë¤í”„ ì „ì²´ ì ìš© â†’ í…Œì´ë¸”Â·ì»¬ëŸ¼ ëˆ„ë½ ì—†ìŒ.
- [x] `simple_backup_system.py`ì—ì„œ `pg_dump` í˜¸ì¶œ ì‹œ í…Œì´ë¸” ì œì™¸ ì˜µì…˜ ì—†ìŒ (ì „ì²´ ë¤í”„).

**ê²°ë¡ **: ì£¼ë¬¸ ê±´ê³¼ ì£¼ë¬¸ì˜ ìƒíƒœ(ì»¬ëŸ¼ ë° ê´€ë ¨ í…Œì´ë¸”)ëŠ” **ì™„ì „íˆ ì €ì¥Â·ë³µì›**ë¨.

---

## 4. ì°¸ì¡°

- ë°±ì—… ë¡œì§: `simple_backup_system.py` â€” `backup_database()`, `execute_backup()`.
- ë°±ì—… API: `app.py` â€” `/api/simple_backup`, `/api/backup_status`, `_run_backup_job`.
- ì£¼ë¬¸ ëª¨ë¸: `models.py` â€” `Order` (status, original_status, cabinet_status, structured_data).
- GDM ë¶„ì„: `docs/evolution/GDM_BACKUP_ISSUE_ANALYSIS_2026-02-17.md`.

*ë¬¸ì„œ ìƒì„±: 2026-02-17. GDM ë°±ì—…/ë³µì› ê²€ì¦ ì˜ë¬´ ë°˜ì˜.*
