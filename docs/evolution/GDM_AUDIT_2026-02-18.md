# FOMS 개발 건강 진단 보고서 (GDM 역할 1번)

> **실행일**: 2026-02-18  
> **기준**: Grand Develop Master 감사 항목 (코드 품질·파일 크기·아키텍처·보안·성능)

---

## 요약

| 항목 | 결과 |
|------|------|
| **전체 점수** | **72/100** |
| **긴급 조치 필요** | 0건 |
| **개선 권장** | 6건 |
| **양호** | 8건 |

---

## 긴급 (🔴)

- **없음.**  
  당장 서비스 중단·보안 사고로 이어질 만한 항목은 없습니다.

---

## 개선 권장 (🟡)

1. **Python 파일이 500줄 넘는 경우**  
   - 규칙(01-clean-code): Python 500줄 이하 권장.  
   - **대상**: `apps/order_pages.py`(약 713줄), `apps/api/erp_map.py`(약 544줄), `apps/api/chat/routes.py`(약 771줄), `apps/api/quest.py`(약 499줄), `apps/api/wdcalculator.py`(약 614줄), `services/erp_policy.py`(약 714줄) 등.  
   - **효과**: 나중에 수정·검색이 쉬워지고, 한 파일 담당 범위가 줄어듭니다.  
   - **우선순위**: 높은 쪽부터 `order_pages.py` → `erp_map.py` → `chat/routes.py` 순으로 나누는 것을 권장합니다.

2. **HTML 템플릿이 800줄 넘는 경우**  
   - 규칙: HTML 800줄 이하 권장.  
   - **대상**: `calculator.html`(약 4,010줄), `erp_construction_dashboard.html`(약 2,704줄), `erp_production_dashboard.html`(약 2,655줄), `regional_dashboard.html`(약 2,161줄), `chat_scripts.html`(약 2,105줄), `erp_dashboard_scripts.html`(약 1,916줄) 등.  
   - **효과**: erp_dashboard·chat처럼 partial로 나누면 수정·재사용이 쉬워집니다.

3. **사용자 입력이 DB/검색에 쓰이는 부분**  
   - `manager_filter`, `filter_value`, `query` 등 요청 파라미터가 `.ilike(f'%{var}%')` 등으로 쓰이고 있으나, **ORM 사용**으로 실제 SQL은 파라미터 바인딩되어 있어 위험도는 낮습니다.  
   - **권장**: 검색어 길이 제한, 특수문자 제한 등 간단한 검증을 두면 더 안전합니다.

4. **스크립트 기본 비밀번호**  
   - `scripts/db_admin.py`에 `password='admin1234'` 기본값이 있습니다.  
   - **권장**: 로컬/관리용이라도 환경변수나 인자로 받도록 바꾸면 좋습니다.

5. **테스트/자동화 커버리지**  
   - 단위·통합 테스트가 거의 없습니다.  
   - **효과**: 리팩터링·배포 시 회귀 버그를 줄일 수 있습니다.  
   - **권장**: 핵심 API·주문 상태 변경부터 pytest로 단계적으로 추가.

6. **N+1 쿼리 가능성**  
   - 대시보드에서 주문 목록을 가져온 뒤 루프 안에서 첨부 개수 등을 조회하는 패턴이 있을 수 있습니다.  
   - **권장**: 필요 시 `joinedload`/`selectinload` 등으로 한 번에 불러오면 응답 속도가 나아질 수 있습니다.

---

## 양호 (🟢)

1. **app.py·erp.py 슬림다운**  
   - app.py 약 319줄, erp.py 40줄로 목표(300줄/500줄)에 맞게 정리되었습니다.

2. **Blueprint·서비스 분리**  
   - ERP 대시보드·주문 API가 역할별 Blueprint로 나뉘어 있고, 공통 로직은 `services/`에 잘 모여 있습니다.

3. **SECRET_KEY 처리**  
   - `app.secret_key`는 환경변수 `SECRET_KEY`에서 읽고, 프로덕션에서는 미설정 시 에러를 내도록 되어 있어 적절합니다.

4. **SQL 삽입 위험**  
   - 쿼리는 대부분 SQLAlchemy ORM으로만 작성되어 있고, `text()` 사용처는 제한적이며 테이블명 등은 코드에서만 사용됩니다.

5. **백업/복원**  
   - 관리자 백업·복원 절차가 있고, 주문·상태·structured_data 포함이 문서에 명시되어 있습니다.

6. **아키텍처 일관성**  
   - 새 기능이 `apps/api/`, `apps/erp_*.py`, `services/` 패턴을 따르고 있습니다.

7. **배포 노트**  
   - DEPLOY_NOTES.md로 배포 내용을 쉬운 한글로 정리하는 흐름이 자리 잡았습니다.

8. **불필요 파일 정리**  
   - 중복 진행 문서(SLIM_DOWN_PROGRESS) 정리, .gitignore 보완이 반영되었습니다.

---

## 다음 액션 (우선순위)

| 순서 | 작업 | 비고 |
|------|------|------|
| 1 | `order_pages.py` 500줄 이하로 분리 | edit_order 등 별도 Blueprint/모듈로 이동 검토 |
| 2 | 대형 템플릿 partial 분리 | calculator, erp_production_dashboard, erp_construction_dashboard 등 |
| 3 | 핵심 API·주문 상태 변경에 pytest 도입 | 단계적 확대 |
| 4 | db_admin 등 스크립트 비밀번호 환경변수화 | 보안 강화 |

---

*이 보고서는 GDM(개발 총괄 감독) 역할 1번 “개발 품질 감사” 결과입니다. 세부 항목은 코드베이스 실제 상태(2026-02-18) 기준입니다.*
