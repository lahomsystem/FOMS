# 📍 주소 변환 시스템 완벽 개발 가이드

> **목적**: 이 문서를 기반으로 Excel 업로드 → 날짜 선택 → 주소 변환 → 지도 표시 시스템을 완벽하게 구현

---

## 🎯 프로젝트 개요

### 핵심 기능
- **Excel 파일 업로드**: .xlsx 파일 지원
- **날짜 기반 필터링**: Excel의 날짜 컬럼으로 데이터 필터링
- **주소 → 좌표 변환**: 카카오맵 API 사용 (API =6b616f811df2a8aeb3ab12ee71152952)
- **대화형 지도 표시**: Folium으로 마커 표시
- **결과 다운로드**: 변환 결과를 Excel로 다운로드

### 기술 스택
- **Backend**: Python 3.8+
- **Web Framework**: Streamlit
- **API**: Kakao REST API (주소 검색)
- **지도**: Folium + streamlit-folium
- **데이터 처리**: pandas, openpyxl
- **GUI**: 웹 기반 (Streamlit)

---

## 📋 요구사항 (requirements.txt)

```
streamlit>=1.28.0
pandas>=2.0.0
folium>=0.14.0
streamlit-folium>=0.15.0
requests>=2.31.0
openpyxl>=3.1.0
```

---

## 🏗️ 파일 구조

```
project/
├── main_app.py                 # 메인 Streamlit 애플리케이션
├── address_converter.py        # 주소 변환 로직
├── map_generator.py           # 지도 생성 로직
├── config.py                  # 설정 파일
├── requirements.txt           # 의존성 패키지
└── README.md                  # 사용 가이드
```

---

## 🔧 상세 구현 명세

### 1. config.py
```python
# 카카오 API 설정
KAKAO_REST_API_KEY = "YOUR_API_KEY_HERE"  # 실제 API 키로 교체

# 기본 설정
DEFAULT_CENTER = [37.5665, 126.9780]  # 서울 중심좌표
MAX_RETRIES = 3                        # API 재시도 횟수
DELAY_BETWEEN_REQUESTS = 0.1           # API 요청 간격 (초)

# 좌표 검증 범위 (한국)
MIN_LAT, MAX_LAT = 33.0, 39.0         # 위도 범위
MIN_LNG, MAX_LNG = 124.0, 132.0       # 경도 범위
```

### 2. address_converter.py

**클래스**: `AddressConverter`

**필수 메서드**:
- `__init__(self)`: API 키 설정 및 기본 URL 설정
- `convert_address(self, address)`: 단일 주소 변환
- `convert_addresses(self, addresses)`: 배치 주소 변환

**핵심 로직**:
```python
def convert_address(self, address):
    """
    단일 주소를 좌표로 변환
    Returns: (위도, 경도, 상태) 튜플
    - 성공시: (float, float, "성공")
    - 실패시: (None, None, "오류메시지")
    """
    
def convert_addresses(self, addresses):
    """
    여러 주소를 배치 변환
    Returns: List[Dict] with keys: ['주소', '위도', '경도', '상태']
    """
```

**API 요청 명세**:
- URL: `https://dapi.kakao.com/v2/local/search/address.json`
- Headers: `{"Authorization": f"KakaoAK {API_KEY}"}`
- Params: `{"query": address}`
- Timeout: 10초

**오류 처리**:
- 빈 주소: "빈 주소"
- API 오류: "API 오류: {status_code}"
- 좌표 없음: "주소를 찾을 수 없음"
- 좌표 범위 초과: "좌표 범위 초과"
- 예외 발생: "변환 오류: {error_message}"

### 3. map_generator.py

**클래스**: `MapGenerator`

**필수 메서드**:
- `create_map(self, coordinates_data)`: 좌표 데이터로 지도 생성

**핵심 로직**:
```python
def create_map(self, coordinates_data):
    """
    좌표 데이터로 Folium 지도 생성
    Args: coordinates_data - List[Dict] with '위도', '경도', '주소' keys
    Returns: folium.Map object or None
    """
```

**지도 설정**:
- 타일: OpenStreetMap
- 줌 레벨: 10 (자동 조정)
- 중심점: 유효한 좌표들의 평균값
- 마커: 주소를 popup과 tooltip으로 표시

### 4. main_app.py

**Streamlit 페이지 구성**:

#### 페이지 설정
```python
st.set_page_config(
    page_title="주소 변환 시스템",
    page_icon="📍",
    layout="wide"
)
```

#### UI 구성 순서

1. **제목 및 설명**
   ```
   st.title("📍 주소 변환 시스템")
   st.write("Excel 업로드 → 날짜 선택 → 주소 변환 → 지도 표시")
   ```

2. **1단계: Excel 파일 업로드**
   - `st.file_uploader()` 사용
   - 지원 형식: .xlsx
   - 업로드 후 컬럼 정보 표시
   - 처음 5행 미리보기 제공

3. **컬럼 자동 감지**
   ```python
   # 주소 컬럼 찾기
   address_columns = [col for col in df.columns 
                     if '주소' in col or 'address' in col.lower()]
   
   # 날짜 컬럼 찾기  
   date_columns = [col for col in df.columns 
                  if '날짜' in col or 'date' in col.lower() or '일자' in col]
   ```

4. **2단계: 날짜 선택 및 필터링**
   
   **날짜 컬럼이 있는 경우**:
   - Excel의 날짜 범위 표시
   - `st.date_input()`으로 날짜 선택
   - 선택한 날짜로 데이터 필터링
   - 필터링 결과 행 수 표시
   
   **날짜 컬럼이 없는 경우**:
   - "전체 주소를 변환합니다" 안내
   - 기록용 날짜만 입력

5. **3단계: 주소 변환**
   - 변환할 주소 개수 표시
   - `st.button()`으로 변환 시작
   - `st.progress()`로 진행상황 표시
   - 변환 결과 통계 (성공률)
   - 결과를 DataFrame으로 표시

6. **결과 처리**
   - 변환날짜, 변환시간 정보 추가
   - `st.dataframe()`으로 결과 표시
   - `st.download_button()`으로 Excel 다운로드

7. **4단계: 지도 표시**
   - 성공한 좌표들만 지도에 표시
   - `st_folium()`으로 지도 렌더링
   - 지도 크기: width=700, height=500

8. **오류 분석**
   - 실패 원인별 통계 제공
   - 명확한 오류 메시지 표시

---

## 🎮 주요 기능 명세

### Excel 파일 처리
```python
# 파일 읽기
df = pd.read_excel(uploaded_file)

# 날짜 컬럼 처리
df[date_col] = pd.to_datetime(df[date_col], errors='coerce')

# 날짜 필터링
filtered_df = df[df[date_col].dt.date == selected_date]
```

### 주소 변환 결과 형식
```python
{
    '주소': "서울시 강남구 테헤란로 123",
    '위도': 37.5013,
    '경도': 127.0396,
    '상태': "성공",
    '변환날짜': "2024-01-15",
    '변환시간': "14:30:25"
}
```

### Excel 다운로드 구현
```python
from io import BytesIO
excel_buffer = BytesIO()
with pd.ExcelWriter(excel_buffer, engine='openpyxl') as writer:
    results_df.to_excel(writer, index=False, sheet_name='변환결과')
excel_data = excel_buffer.getvalue()
```

---

## 🛡️ 오류 처리 가이드

### 필수 검증 항목
1. **파일 업로드 검증**
   - 파일 형식 (.xlsx만 허용)
   - 파일 크기 제한
   - pandas 읽기 가능 여부

2. **컬럼 검증**
   - 주소 컬럼 존재 여부
   - 날짜 컬럼 형식 검증
   - 빈 값 처리

3. **API 호출 검증**
   - API 키 유효성
   - 네트워크 연결
   - 응답 상태 코드
   - 응답 데이터 형식

4. **좌표 검증**
   - 한국 영토 내 좌표인지 확인
   - 위도: 33.0~39.0
   - 경도: 124.0~132.0

### 오류 메시지 표준
- **성공**: "성공"
- **빈 주소**: "빈 주소"
- **API 오류**: "API 오류: {status_code}"
- **주소 없음**: "주소를 찾을 수 없음"
- **좌표 범위 초과**: "좌표 범위 초과"
- **변환 오류**: "변환 오류: {error_message}"

---

## 🎨 UI/UX 가이드라인

### 디자인 원칙
- **간결성**: 불필요한 설명 최소화
- **명확성**: 각 단계별 진행상황 표시
- **반응성**: 즉각적인 피드백 제공

### 컬러 코딩
- **성공**: 녹색 (st.success)
- **경고**: 노란색 (st.warning)  
- **오류**: 빨간색 (st.error)
- **정보**: 파란색 (st.info)

### 아이콘 사용
- 📍 지도/주소
- 📅 날짜
- 📋 데이터
- 🔄 변환
- 📥 다운로드
- ✅ 성공
- ❌ 실패
- ⚠️ 경고

---

## 🚀 실행 가이드

### 환경 설정
1. Python 3.8+ 설치
2. 가상환경 생성 및 활성화
3. requirements.txt 설치: `pip install -r requirements.txt`
4. 카카오 API 키를 config.py에 설정

### 실행 명령
```bash
streamlit run main_app.py --server.port 8503
```

### 테스트 시나리오
1. **기본 테스트**: 날짜 컬럼이 있는 Excel 파일 업로드
2. **날짜 필터링**: 특정 날짜 선택 후 변환
3. **전체 변환**: 날짜 컬럼이 없는 파일 테스트
4. **오류 처리**: 잘못된 주소 포함 파일 테스트

---

## 📊 성능 목표

- **변환 성공률**: 60% 이상
- **응답 시간**: 주소당 1초 이내
- **동시 처리**: 100개 주소 배치 처리
- **메모리 사용량**: 1GB 이내
- **오류 처리**: 모든 예외 상황 대응

---

## 🔒 보안 고려사항

- API 키를 환경변수로 관리 권장
- 업로드 파일 크기 제한
- 악성 스크립트 방지
- 개인정보 처리 최소화

---

## 📝 추가 기능 (선택사항)

### Phase 2 기능
- 주소 변환 캐시 시스템
- 실시간 진행률 표시
- 변환 실패 주소 수동 수정
- 다양한 지도 타일 옵션

### Phase 3 기능  
- 대량 데이터 처리 (1000개+)
- 클러스터링 기능
- 통계 대시보드
- 사용자 인증 시스템

---

## ⚠️ 중요 주의사항

1. **API 키 보안**: config.py의 API 키를 실제 운영 키로 교체
2. **요청 제한**: 카카오 API 일일 제한량 확인
3. **좌표 정확성**: 변환된 좌표의 정확성 검증 필요
4. **대용량 파일**: 메모리 부족 방지를 위한 배치 처리
5. **브라우저 호환성**: Chrome, Firefox, Safari 지원 확인

---

## 🎯 완성 체크리스트

### 필수 기능
- [ ] Excel 파일 업로드 (.xlsx)
- [ ] 주소/날짜 컬럼 자동 감지
- [ ] 날짜 선택 및 데이터 필터링
- [ ] 카카오 API 주소 변환
- [ ] Folium 지도 생성 및 마커 표시
- [ ] 변환 결과 Excel 다운로드
- [ ] 오류 처리 및 메시지 표시

### 품질 요구사항
- [ ] 주소 변환 성공률 60% 이상
- [ ] 명확한 UI/UX (단계별 안내)
- [ ] 모든 예외 상황 처리
- [ ] 코드 가독성 및 주석
- [ ] 성능 최적화

### 테스트 완료
- [ ] 날짜 필터링 기능 테스트
- [ ] 전체 주소 변환 테스트  
- [ ] 오류 시나리오 테스트
- [ ] 대용량 파일 테스트
- [ ] 브라우저 호환성 테스트

---

**이 가이드를 바탕으로 구현하면 안정적이고 사용자 친화적인 주소 변환 시스템을 완성할 수 있습니다.** 