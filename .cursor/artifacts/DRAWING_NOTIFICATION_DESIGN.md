# ğŸ“‹ ë„ë©´ ì „ë‹¬ ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ¯ ëª©ì 
ë„ë©´íŒ€ì—ì„œ ë„ë©´ ì™„ì„± í›„ **ê´€ë ¨ íŒ€ ë° ê³ ê°ì—ê²Œ ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” ì—­í• **

---

## ğŸ“¤ ì•Œë¦¼ ëŒ€ìƒ ë° ë°©ë²•

### 1. ì˜ì—…íŒ€ (SALES)
**ì•Œë¦¼ ëª©ì **: ê³ ê° ì»¨íŒ ì¼ì • ì¡°ìœ¨ ì¤€ë¹„
- **ì•Œë¦¼ ì±„ë„**: 
  - ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ ë°°ì§€ (ì‹¤ì‹œê°„)
  - ë‹´ë‹¹ì ì´ë©”ì¼ (ì„ íƒì )
- **ì•Œë¦¼ ë‚´ìš©**:
  ```
  [ì£¼ë¬¸ #1234] ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤
  ê³ ê°: í™ê¸¸ë™ | ì—°ë½ì²˜: 010-1234-5678
  ë©”ëª¨: {ë„ë©´íŒ€ ë©”ëª¨}
  â†’ ê³ ê° ì»¨íŒ ì¼ì •ì„ ì¡°ìœ¨í•´ì£¼ì„¸ìš”.
  ```

### 2. ê³ ê° (CUSTOMER)  
**ì•Œë¦¼ ëª©ì **: ë„ë©´ í™•ì¸ ë° ì»¨íŒ ìš”ì²­
- **ì•Œë¦¼ ì±„ë„**:
  - ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ (ìë™)
  - SMS (ëŒ€ì²´)
- **ì•Œë¦¼ ë‚´ìš©**:
  ```
  [ë¼í™ˆ] ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.
  
  ì•ˆë…•í•˜ì„¸ìš”, {ê³ ê°ëª…}ë‹˜.
  ì£¼ë¬¸í•˜ì‹  ê°€êµ¬ì˜ ë„ë©´ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
  
  ë‹´ë‹¹ìê°€ ê³§ ì—°ë½ë“œë ¤ ì¼ì •ì„ ì¡°ìœ¨í•  ì˜ˆì •ì…ë‹ˆë‹¤.
  
  - ë¼í™ˆ ê°€êµ¬
  ```

### 3. CSíŒ€ (ë°œì£¼ì‚¬ê°€ 'ë¼í™ˆ'ì¸ ê²½ìš°)
**ì•Œë¦¼ ëª©ì **: ë¼í™ˆ ì§ì ‘ ì£¼ë¬¸ ê±´ ê´€ë¦¬
- **ì•Œë¦¼ ì±„ë„**: ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ ë°°ì§€
- **ì¡°ê±´**: `orderer.name`ì— 'ë¼í™ˆ' í¬í•¨ ì‹œì—ë§Œ ë°œì†¡

---

## ğŸ”” ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„ ë°©ì•ˆ

### Option A: ì¸ì•± ì•Œë¦¼ (ê¶Œì¥ - 1ë‹¨ê³„)
```python
# structured_dataì— ì•Œë¦¼ ê¸°ë¡
{
  "notifications": [
    {
      "type": "DRAWING_TRANSFERRED",
      "target_team": "SALES",
      "target_user_id": null,  # íŠ¹ì • ë‹´ë‹¹ì or null(íŒ€ ì „ì²´)
      "message": "ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤",
      "created_at": "2026-02-07T22:00:00",
      "read": false
    }
  ]
}
```

**ëŒ€ì‹œë³´ë“œ í‘œì‹œ**:
- ê° íŒ€ ëŒ€ì‹œë³´ë“œ ìƒë‹¨ì— **ì•Œë¦¼ ë°°ì§€** í‘œì‹œ
- í´ë¦­ ì‹œ ê´€ë ¨ ì£¼ë¬¸ìœ¼ë¡œ ë°”ë¡œ ì´ë™

### Option B: ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ (2ë‹¨ê³„)
- ê³ ê° ì—°ë½ì²˜ë¡œ ì•Œë¦¼í†¡ ë°œì†¡
- ë¹„ì¦ˆë‹ˆìŠ¤ ì±„ë„ ì—°ë™ í•„ìš”

### Option C: ì´ë©”ì¼ ì•Œë¦¼ (3ë‹¨ê³„)
- ë‹´ë‹¹ì ì´ë©”ì¼ë¡œ ë°œì†¡
- ì‚¬ìš©ì ì´ë©”ì¼ ì •ë³´ í•„ìš”

---

## ğŸ“Š ì•Œë¦¼ íë¦„ë„

```
ë„ë©´ ì „ë‹¬ ë²„íŠ¼ í´ë¦­
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  structured_data ì—…ë°ì´íŠ¸           â”‚
â”‚  - drawing_transferred = true       â”‚
â”‚  - last_drawing_transfer = info     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì•Œë¦¼ ìƒì„±                          â”‚
â”‚  1. ì˜ì—…íŒ€ â†’ ì¸ì•± ì•Œë¦¼ ìƒì„±         â”‚
â”‚  2. ë°œì£¼ì‚¬='ë¼í™ˆ' â†’ CSíŒ€ ì•Œë¦¼ ì¶”ê°€  â”‚
â”‚  3. ê³ ê° â†’ ì•Œë¦¼í†¡ ë°œì†¡ (2ë‹¨ê³„)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ëŒ€ì‹œë³´ë“œ ë°˜ì˜                      â”‚
â”‚  - ì˜ì—…íŒ€: ğŸ”” ë°°ì§€ + ëª©ë¡ í‘œì‹œ     â”‚
â”‚  - í•´ë‹¹ ì£¼ë¬¸: "ë„ë©´ ì „ë‹¬ë¨" ìƒíƒœ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ êµ¬í˜„ ìš°ì„ ìˆœìœ„

| ë‹¨ê³„ | ê¸°ëŠ¥ | ë‚œì´ë„ | íš¨ê³¼ |
|------|------|--------|------|
| **1ë‹¨ê³„** | ì¸ì•± ì•Œë¦¼ ë°°ì§€ (ëŒ€ì‹œë³´ë“œ) | â­â­ | ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥ |
| **2ë‹¨ê³„** | ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ (ê³ ê°) | â­â­â­ | ê³ ê° ë§Œì¡±ë„ â†‘ |
| **3ë‹¨ê³„** | ì´ë©”ì¼ ì•Œë¦¼ (ë‹´ë‹¹ì) | â­â­ | ì˜¤í”„ë¼ì¸ í™•ì¸ |

---

## ğŸ“ 1ë‹¨ê³„ êµ¬í˜„ ìƒì„¸

### API ìˆ˜ì • (`api_order_transfer_drawing`)
```python
# ì•Œë¦¼ ìƒì„±
notifications = s_data.get('notifications') or []
now_str = datetime.now().isoformat()

# ì˜ì—…íŒ€ ì•Œë¦¼
notifications.append({
    'id': str(uuid.uuid4()),
    'type': 'DRAWING_TRANSFERRED',
    'target_team': 'SALES',
    'order_id': order_id,
    'message': f'ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ({note})',
    'created_at': now_str,
    'read': False
})

# ë°œì£¼ì‚¬ê°€ 'ë¼í™ˆ'ì¸ ê²½ìš° CSíŒ€ì—ë„ ì•Œë¦¼
orderer_name = (s_data.get('parties') or {}).get('orderer', {}).get('name', '')
if 'ë¼í™ˆ' in orderer_name:
    notifications.append({
        'id': str(uuid.uuid4()),
        'type': 'DRAWING_TRANSFERRED',
        'target_team': 'CS',
        'order_id': order_id,
        'message': f'[ë¼í™ˆì£¼ë¬¸] ë„ë©´ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.',
        'created_at': now_str,
        'read': False
    })

s_data['notifications'] = notifications
```

### ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ í‘œì‹œ
```javascript
// í—¤ë”ì— ì•Œë¦¼ ë°°ì§€ í‘œì‹œ
const unreadCount = orders.filter(o => 
    o.notifications?.some(n => !n.read && n.target_team === MY_TEAM)
).length;

if (unreadCount > 0) {
    document.querySelector('.notification-badge').textContent = unreadCount;
    document.querySelector('.notification-badge').style.display = 'block';
}
```

---

## âœ… ë‹¤ìŒ ë‹¨ê³„
1. 1ë‹¨ê³„ (ì¸ì•± ì•Œë¦¼) êµ¬í˜„ ìŠ¹ì¸ ì‹œ ì§„í–‰
2. ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ API ì—°ë™ ê²€í† 
3. ì‚¬ìš©ìë³„ ì•Œë¦¼ ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€
