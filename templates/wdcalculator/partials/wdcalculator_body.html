<div class="container-fluid py-4 wdcalculator-container">
    <div class="row">
        <!-- [LEFT] 저장된 견적 목록 사이드바 -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm sticky-top" style="top: 20px; max-height: calc(100vh - 40px); display: flex; flex-direction: column;">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold"><i class="fas fa-history text-info"></i> 저장된 견적</h5>
                    <button class="btn btn-sm btn-outline-primary" id="refreshEstimatesBtn" title="새로고침">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="card-body p-2 d-flex flex-column" style="overflow: hidden;">
                    <!-- 검색 -->
                    <div class="input-group mb-3 flex-shrink-0">
                        <input type="text" class="form-control" id="sidebarSearchInput" placeholder="고객명 검색...">
                        <button class="btn btn-outline-secondary" type="button" id="sidebarSearchBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <!-- 목록 (스크롤 영역) -->
                    <div class="flex-grow-1 overflow-auto" id="savedEstimatesListContainer" style="min-height: 0;">
                        <div class="text-center py-5 text-muted" id="savedEstimatesLoading">
                            <div class="spinner-border spinner-border-sm mb-2" role="status"></div>
                            <p>견적 목록을 불러오는 중...</p>
                        </div>
                        <div class="list-group list-group-flush" id="savedEstimatesList">
                            <!-- JS로 렌더링됨 -->
                        </div>
                        <div class="text-center py-5 text-muted" id="noSavedEstimates" style="display: none;">
                            <i class="far fa-folder-open fa-3x mb-3"></i>
                            <p>저장된 견적이 없습니다.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- [RIGHT] 계산기 메인 영역 -->
        <div class="col-lg-9">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0"><i class="fas fa-calculator text-info"></i> 가구 견적 계산기</h1>
        <div>
            <a href="{{ url_for('wdcalculator.wdcalculator_product_settings') }}" class="btn btn-info">
                <i class="fas fa-cog"></i> 제품 설정
            </a>
        </div>
    </div>

    <div class="row">
        <!-- 입력 섹션 -->
        <div class="col-lg-7 mb-4">
            <div class="card shadow border-left-primary">
                <div class="card-header py-3 header-primary">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-edit me-2"></i>견적 정보 입력
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="customerName" class="form-label">고객명</label>
                        <input type="text" class="form-control" id="customerName" placeholder="고객명을 입력하세요">
                    </div>

                    <!-- 기본 구성(복합 기본 견적) -->
                    <div class="mb-3">
                        <label class="form-label">기본 구성 <span class="text-danger">*</span></label>
                        <div id="baseComponentsContainer">
                            <!-- JS로 구성 행이 렌더링됩니다 -->
                        </div>
                        <div class="d-flex gap-2 mt-2">
                            <button type="button" class="btn btn-sm btn-outline-info" id="addBaseComponentBtn">
                                <i class="fas fa-plus"></i> 기본 구성 추가
                            </button>
                        </div>
                        
                    </div>

                    <!-- 제품 정보 표시 -->
                    <div id="productInfo" class="mb-3" style="display: none;">
                        <div class="alert alert-info">
                            <strong>선택된 제품 정보</strong>
                            <div id="productInfoContent"></div>
                        </div>
                    </div>

                    <!-- 기본 견적 표시 -->
                    <div id="baseEstimateSection" class="mb-3" style="display: none;">
                        <div class="card estimate-card">
                            <div class="card-body">
                                <h6 class="card-title">기본 견적</h6>
                                <div class="price-display" id="basePriceDisplay">0원</div>
                            </div>
                        </div>
                    </div>

                    <!-- 추가 옵션 섹션 -->
                    <div class="mb-3">
                        <label class="form-label">추가 옵션</label>
                        <div id="additionalOptionsContainer">
                            <!-- 동적으로 추가됨 -->
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-info" id="addOptionBtn">
                            <i class="fas fa-plus"></i> 옵션 추가
                        </button>
                    </div>

                    <!-- 비고 입력 -->
                    <div class="mb-3">
                        <label class="form-label">비고</label>
                        <div id="notesContainer">
                            <!-- 동적으로 비고 항목들이 추가됨 -->
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="btnAddNote">
                            <i class="fas fa-plus"></i> 비고 추가
                        </button>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- 견적 결과 섹션 -->
        <div class="col-lg-5 mb-4">
            <div class="card shadow border-left-success">
                <div class="card-header py-3 header-success">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-receipt me-2"></i>견적 결과
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                            <span>기본 견적:</span>
                            <strong id="totalBasePrice">0원</strong>
                        </div>
                                    <div class="text-muted small" id="baseEstimateDetail" style="padding-left: 0.5rem;"></div>
                                </div>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                            <span>추가 옵션 합계:</span>
                            <strong id="totalAdditionalPrice">0원</strong>
                                    </div>
                                    <div class="text-muted small" id="additionalOptionsDetail" style="padding-left: 0.5rem;"></div>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="h5 mb-0">총견적:</span>
                            <strong class="price-display" id="totalPrice">0원</strong>
                        </div>
                    </div>

                    <div class="card bg-light final-summary-card text-center">
                        <div class="card-body">
                            <h6 class="card-title mb-3">총견적</h6>
                                <div class="final-price-display mb-2" id="finalPrice">0원</div>
                                <small class="text-muted" id="couponInfo">쿠폰가 미적용</small>
                        </div>
                    </div>

                    <!-- 비고 표시 -->
                    <div class="mt-3" id="notesDisplaySection" style="display: none;">
                        <div class="card border-warning">
                            <div class="card-body">
                                <h6 class="card-title mb-2">
                                    <i class="fas a-sticky-note text-warning me-2"></i>비고
                                </h6>
                                <p class="mb-0 text-muted small" id="notesDisplay" style="white-space: pre-wrap;"></p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="button" class="btn btn-success w-100" id="calculateBtn">
                            <i class="fas fa-calculator"></i> 견적 계산
                        </button>
                                <button type="button" class="btn btn-primary w-100 mt-2" id="addEstimateBtn" style="display: block;">
                                    <i class="fas fa-plus"></i> 견적 추가
                                </button>
                                <button type="button" class="btn btn-info w-100 mt-2" id="saveEstimateBtn" style="display: block;">
                                    <i class="fas fa-save"></i> 견적 저장
                        </button>
                    </div>
                </div>
            </div>
        </div>
                
                <!-- 진행 중인 견적 목록 -->
                <div class="col-lg-12 mt-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-list"></i> 진행 중인 견적</h5>
    </div>
                        <div class="card-body">
                            <div id="estimatesListContainer">
                                <p class="text-muted text-center mb-0">추가된 견적이 없습니다.</p>
                            </div>
                            <!-- 전체 견적 총 합계는 renderEstimatesList()에서 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>
            </div> <!-- 메인 컨텐츠 내부 row 종료 -->
        </div> <!-- col-lg-9 종료 -->
    </div> <!-- 최상위 row 종료 -->
    
    <!-- 쿠폰가 설정 (단독 카테고리) -->
    <div class="row mt-4">
        <div class="col-lg-9 offset-lg-3">
            <div class="card shadow border-left-info">
                <div class="card-header py-3 header-info">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-tag me-2"></i>쿠폰가 설정
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="globalCouponValue" class="form-label">할인 금액 (원)</label>
                        <input type="number" class="form-control" id="globalCouponValue" min="0" step="1" value="11000" placeholder="할인 금액을 입력하세요">
                        <small class="form-text text-muted">
                            <i class="fas fa-info-circle"></i> 최종 견적에 적용될 고정 할인 금액입니다.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 배송비 설정 (쿠폰가 설정 아래에 추가) -->
    <div class="row mt-4">
        <div class="col-lg-9 offset-lg-3">
            <div class="card shadow border-left-warning">
                <div class="card-header py-3 header-warning">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-truck me-2"></i>배송비 설정
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="shippingCost" class="form-label">배송비 (원)</label>
                        <input type="number" class="form-control" id="shippingCost" min="0" step="1" value="0" placeholder="배송비를 입력하세요">
                        <small class="form-text text-muted">
                            <i class="fas fa-info-circle"></i> 지방시공, 자가실측 또는 특정 지역의 경우 배송비를 입력하세요.
                        </small>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="shippingIncluded" checked>
                            <label class="form-check-label" for="shippingIncluded">
                                <strong>최종 금액에 배송비 포함</strong>
                            </label>
                            <small class="form-text text-muted d-block ms-4">
                                <i class="fas fa-info-circle"></i> 체크 해제 시 배송비는 별도 표기만 되고 최종 금액에는 포함되지 않습니다.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- container-fluid 종료 -->

<div id="wdcalculator-config" class="d-none"
     data-categories="{{ (categories|default([]))|tojson|replace('"', '&quot;')|safe }}"
     data-notes-categories="{{ (notes_categories|default([]))|tojson|replace('"', '&quot;')|safe }}"></div>
